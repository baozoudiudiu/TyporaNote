小程序发起支付前，需要后端先发起支付，调用“统一下单”接口：https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3_5_1.shtml，然后返回必要参数给到小程序端。

需要参数如下：

| 字段名    | 格式   | 描述                                                         |
| --------- | ------ | ------------------------------------------------------------ |
| timeStamp | String | 后端调用“统一下单”时，生成的时间戳                           |
| nonceStr  | String | 随机字符串                                                   |
| package   | String | "统一下单"接口返回的 prepay_id 参数值，提交格式如：prepay_id=***<br />示例值：prepay_id=wx201410272009395522657a690389285100 |
| signType  | String | 签名类型，默认为RSA，仅支持RSA                               |
| paySign   | String | 签名，使用字段appId、timeStamp、nonceStr、package计算得出的签名值 |

### paySign签名：

#### 1、构造签名串

```js
签名串一共有四行，每一行为一个参数。行尾以\n（换行符，ASCII编码值为0x0A）结束，包括最后一行。
如果参数本身以\n结束，也需要附加一个\n
```

**参与签名字段及格式：**

```js
小程序appId
时间戳
随机字符串
订单详情扩展字符串
```

**数据举例：**

```js
wx8888888888888888
1414561699
5K8264ILTKCH16CQ2502SI8ZNMTM67VS
prepay_id=wx201410272009395522657a690389285100 
```

#### 2、计算签名值

绝大多数编程语言提供的签名函数支持对*签名数据* 进行签名。强烈建议商户调用该类函数，使用商户私钥对*待签名串*进行SHA256 with RSA签名，并对签名结果进行*Base64编码*得到签名值。

下面我们使用命令行演示如何生成签名。

```js
$ echo -n -e \
"wx8888888888888888\n1414561699\n5K8264ILTKCH16CQ2502SI8ZNMTM67VS\nprepay_id=wx201410272009395522657a690389285100\n" \
  | openssl dgst -sha256 -sign apiclient_key.pem \
  | openssl base64 -A
  uOVRnA4qG/MNnYzdQxJanN+zU+lTgIcnU9BxGw5dKjK+VdEUz2FeIoC+D5sB/LN+nGzX3hfZg6r5wT1pl2ZobmIc6p0ldN7J6yDgUzbX8Uk3sD4a4eZVPTBvqNDoUqcYMlZ9uuDdCvNv4TM3c1WzsXUrExwVkI1XO5jCNbgDJ25nkT/c1gIFvqoogl7MdSFGc4W4xZsqCItnqbypR3RuGIlR9h9vlRsy7zJR9PBI83X8alLDIfR1ukt1P7tMnmogZ0cuDY8cZsd8ZlCgLadmvej58SLsIkVxFJ8XyUgx9FmutKSYTmYtWBZ0+tNvfGmbXU7cob8H/4nLBiCwIUFluw==         
```
